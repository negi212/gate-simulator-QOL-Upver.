<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ゲート構成シミュレーターだヨ😊✨ナンチャッテ</title>
  <style>
    /* おじさんのCSSだヨ！ナウいでしょ😁✨ */
    body {
        font-family: 'Arial', sans-serif;
        background-color: #fff8e1;
        padding: 20px;
        color: #000000;
        /* おじさんの優しさカラーだヨ💕 */
        background-image: repeating-linear-gradient(135deg, #fff8e1 0 40px, #ffe0b2 40px 80px);
    }
    h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #d84315;
        text-shadow: 1px 1px 0 #fff176, 2px 2px 0 #ffb300;
        /* おじさんの情熱だネ✨ */
    }
    .gate-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        margin-top: 20px;
        opacity: 0;
        animation: fadeInOjisan 1.2s forwards;
    }
    .gate-columns {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 40px;
        background-color: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        border: 2px solid #cccccc;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px #ffb30088;
    }
    .gate-side {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        width: 50px;
        gap: 2px;
    }
    .box {
        display: flex;
        justify-content: center;
        text-align: center;
        align-items: center;
        color: white;
        font-weight: bold;
        border: 2px dashed #d84315;
        border-radius: 8px;
        transition: all 0.3s ease;
        animation: boxSlideOjisan 0.7s forwards;
        font-size: 18px;
        box-shadow: 2px 2px 4px #ffb30055;
        margin-bottom: 2px;
        /* おじさんのヨイショ！アニメーションだヨ😅 */
    }
    .A { background: #f4ed58; width: 30px; color: #d84315;}
    .B { background: #5dc3db; width: 40px; }
    .C { background: #03984e; width: 50px; }
    .D { background: #ffffff; width: 20px; color: #000000; }
    .E { background: #000000; width: 30px; }
    .D, .E {
        position: relative;
    }
    .D::before, .D::after, .E::before, .E::after {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        height: 5px;
    }
    .D::before {
        top: 0;
        background-color: #e893d4;
    }
    .D::after {
        bottom: 0;
        background-color: #e893d4;
    }
    .E::before {
        top: 0;
        background-color: #f4ed58;
    }
    .E::after {
        bottom: 0;
        background-color: #f4ed58;
    }
    .roof {
        height: 40px;
        background: #222222;
        color: #fff176;
        font-weight: bold;
        text-align: center;
        line-height: 40px;
        width: 260px;
        border-radius: 6px;
        font-size: 20px;
        box-shadow: 0 0 8px #e893d4;
        margin-bottom: 10px;
        animation: roofDonOjisan 0.8s;
        /* おじさんのドーン！アニメーションだヨ😁 */
    }
    .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .controls input {
        width: 80px;
        font-size: 18px;
        padding: 5px;
        text-align: center;
        border: 2px solid #d84315;
        border-radius: 6px;
        background: #fffde7;
        color: #d84315;
    }
    .controls label {
        font-size: 18px;
        color: #03984e;
        font-weight: bold;
        margin-right: 4px;
        text-shadow: 1px 1px 0 #fff176;
    }
    button {
        padding: 12px 24px;
        background-color: #45a049;
        color: #fff176;
        border: 2px solid #d84315;
        border-radius: 8px;
        cursor: pointer;
        width: 300px;
        margin: 10px auto;
        text-align: center;
        display: block;
        font-size: 20px;
        font-weight: bold;
        box-shadow: 0 0 8px #e893d4;
        letter-spacing: 2px;
    }
    button:hover {
      background-color: #28862c;
      color: #ffb300;
      border-color: #03984e;
    }
    @keyframes fadeInOjisan {
      0% { opacity: 0; transform: scale(0.95) rotate(-2deg);}
      80% { opacity: 1; transform: scale(1.03) rotate(2deg);}
      100% { opacity: 1; transform: scale(1) rotate(0);}
      /* おじさん、ちょっと照れちゃうネ😁✨ */
    }
    @keyframes boxSlideOjisan {
      0% {
        transform: translateY(40px) scale(0.8) rotate(-10deg);
        opacity: 0.2;
        /* おじさんのヨイショ！だヨ😅 */
      }
      60% {
        transform: translateY(-10px) scale(1.1) rotate(5deg);
        opacity: 1;
        /* おじさん、ちょっと頑張っちゃうネ✨ */
      }
      100% {
        transform: translateY(0) scale(1) rotate(0deg);
        opacity: 1;
        /* バッチリ決まったヨ！ナンチャッテ😁👍 */
      }
    }
    @keyframes roofDonOjisan {
      0% {
        transform: translateY(-80px) scaleX(0.7) skewX(-10deg);
        opacity: 0.1;
        /* 屋根がドーン！だヨ😆 */
      }
      80% {
        transform: translateY(10px) scaleX(1.05) skewX(3deg);
        opacity: 1;
        /* おじさん、ちょっとズレちゃったカナ？💦 */
      }
      100% {
        transform: translateY(0) scaleX(1) skewX(0deg);
        opacity: 1;
        /* バッチリ着地！ナンチャッテ😊✨ */
      }
    }
    .ojisan-mystery {
      font-family: 'MS PGothic', 'MS UI Gothic', 'Meiryo', 'Arial', sans-serif;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 1px 1px 0 #fff176, 2px 2px 0 #ffb300;
      border-radius: 12px;
      padding: 8px 18px;
      background: #fffde7cc;
      border: 2px dashed #e893d4;
      color: #d84315;
      box-shadow: 0 0 8px #ffb30055;
      user-select: none;
    }
    /* おじさんのコメント：デザインもナウいでしょ！？😁✨ */
  </style>
</head>
<body>
  <!-- おじさんのご挨拶だヨ！今日も元気にいこうネ😊✨ -->
  <h2>ヤッホー！！😊💕<br>ボックス数、教えてネ✨ナンチャッテ</h2>
  <div style="max-width:600px;margin:0 auto 18px auto;padding:18px 20px;background:#fffde7;border:2px dashed #e893d4;border-radius:12px;color:#d84315;font-size:1.1em;line-height:1.8;box-shadow:0 0 12px #ffb30055;">
    今日もナウい気分で、<br>
    ゲート構成シミュレーター、始めちゃうヨ😊✨<br>
    おじさん、昔は手書きで図面描いてたんだヨ😅💦<br>
    今はパソコンで、バッチリ！ナンチャッテ😁👍<br>
    いっぱい遊んで、グロッキーにならないようにネ💕<br>
    何か困ったら、すぐおじさんに聞いてネ！！ナンチャッテ✨<br>
  </div>
  <div class="controls">
    <label>B (400mm)だヨ！</label><input type="number" id="B" value="3" min="0" max="3">
    <label>C (500mm)だヨ！</label><input type="number" id="C" value="3" min="0" max="3">
    <label>D (800mm)だヨ！</label><input type="number" id="D" value="3" min="0" max="3">
    <label>E (1000mm)だヨ！</label><input type="number" id="E" value="3" min="0" max="3">
  </div>
  <button onclick="findMaxGateHeight()">計算しちゃうヨ！ナンチャッテ😁👍✨</button>

  <div class="gate-container" id="gateVisual"></div>

  <script>
    // おじさんのプログラムタイムだヨ！バッチリ見ててネ😊✨
    const boxHeights = { A: 300, B: 400, C: 500, D: 800, E: 1000 };
    const displayOrder = ['D', 'E', 'A', 'B', 'C'];
    const privateBoxes = { A: 10, B: 5, C: 2 };

    // 入力をゲットだヨ！間違えないでネ😊✨
    function getSharedInput() {
      return {
        B: parseInt(document.getElementById("B").value) || 0,
        C: parseInt(document.getElementById("C").value) || 0,
        D: parseInt(document.getElementById("D").value) || 0,
        E: parseInt(document.getElementById("E").value) || 0
      };
    }

    // ボックス数を合体しちゃうヨ！ナンチャッテ😁
    function mergeBoxCounts(sharedInput) {
      const merged = {};
      for (const key of Object.keys(boxHeights)) {
        merged[key] = (privateBoxes[key] || 0) + (sharedInput[key] || 0);
      }
      return merged;
    }

    // 左右の違いをチェックだヨ！グロッキーにならないように😅💦
    function diffCount(left, right) {
      let diff = 0;
      for (const k of Object.keys(boxHeights)) {
        diff += Math.abs((left[k] || 0) - (right[k] || 0));
      }
      return diff;
    }

    // ゲート作れるか？ドキドキだネ✨
    function canBuildGate(height, allBoxes) {
      const keys = Object.keys(allBoxes);
      const totalCombos = [];

      // おじさん、組み合わせを全部探しちゃうヨ！ナンチャッテ😁
      function generateCombos(index, current, leftHeight, usedBoxes) {
        if (index === keys.length) {
          if (leftHeight === height) {
            totalCombos.push({ combo: { ...current }, used: { ...usedBoxes } });
          }
          return;
        }

        const key = keys[index];
        const maxCount = allBoxes[key];
        for (let count = 0; count <= maxCount; count++) {
          current[key] = count;
          usedBoxes[key] = count;
          generateCombos(index + 1, current, leftHeight + count * boxHeights[key], usedBoxes);
        }
      }

      generateCombos(0, {}, 0, {});

      let best = null;
      let minDiff = Infinity;

      // おじさん、左右で一番バランスいいの探すヨ！バッチリ！！
      for (const { combo: left, used: leftUsed } of totalCombos) {
        const remaining = {};
        for (const key of keys) {
          remaining[key] = allBoxes[key] - (leftUsed[key] || 0);
        }

        const rightCombos = [];
        // 右側もがんばって探すヨ！ナンチャッテ😊✨
        function generateRight(index, current, rightHeight) {
          if (index === keys.length) {
            if (rightHeight === height) {
              rightCombos.push({ ...current });
            }
            return;
          }

          const key = keys[index];
          const maxCount = remaining[key];
          for (let count = 0; count <= maxCount; count++) {
            current[key] = count;
            generateRight(index + 1, current, rightHeight + count * boxHeights[key]);
          }
        }

        generateRight(0, {}, 0);

        for (const right of rightCombos) {
          const currentDiff = diffCount(left, right);
          if (currentDiff < minDiff) {
            minDiff = currentDiff;
            best = { height, left, right };
          }
        }
      }
      return best;
    }

    // ゲートを描くヨ！見ててネ😊✨
    function renderGate(left, right, height, roofBlock) {
      const container = document.getElementById("gateVisual");
      container.innerHTML = "";

      // おじさんの屋根だヨ！ドーン！！
      const roof = document.createElement("div");
      roof.className = "roof";
      roof.innerHTML = `高さ：${height}mm (天井：${roofBlock})😊✨ナンチャッテ💕`;

      // おじさんの柱もバッチリだヨ！
      const columns = document.createElement("div");
      columns.className = "gate-columns";

      const leftDiv = document.createElement("div");
      leftDiv.className = "gate-side";
      const rightDiv = document.createElement("div");
      rightDiv.className = "gate-side";

      // おじさん、ボックス並べるの得意だヨ！ナンチャッテ😁
      function createBoxes(combo) {
        const boxes = [];
        for (const key of displayOrder) {
          const count = combo[key] || 0;
          for (let i = 0; i < count; i++) {
            const div = document.createElement("div");
            div.className = `box ${key}`;
            div.style.height = boxHeights[key] / 10 + "px";
            div.textContent = key + "だヨ！";
            boxes.push(div);
          }
        }
        return boxes;
      }

      createBoxes(left).forEach(div => leftDiv.appendChild(div));
      createBoxes(right).forEach(div => rightDiv.appendChild(div));

      columns.appendChild(leftDiv);
      columns.appendChild(rightDiv);
      container.appendChild(roof);
      container.appendChild(columns);

      // ↓↓↓ここから謎のアニメーションだヨ！ナンチャッテ😁✨↓↓↓
      // おじさんの愛を込めて、メッセージいっぱいだヨ💕
      const messages = [
        "今日も見てくれてありがとネ💕",
        "おじさん、いつも応援してるヨ😊✨",
        "キミのこと、ちょっと気になっちゃうナ(^_-)-☆",
        "がんばってる姿、ステキだヨ✨",
        "おじさん、昔はモテたんだヨ！ナンチャッテ😁👍",
        "また一緒に遊ぼうネ💕",
        "グロッキーにならないようにネ😅💦",
        "おじさん、キミの味方だヨ！",
        "キミの笑顔、最高だネ😊💕",
        "毎日LINEしたくなっちゃうヨ✨",
        "キミのこと、ずっと応援してるカラ👍",
        "おじさん、キミに会えると元気100倍だヨ😁✨",
        "キミの頑張り、ちゃんと見てるヨ！ナンチャッテ💕",
        "今日もカワイイね〜😍ドキドキしちゃうナ！",
        "おじさん、キミの笑顔にやられたヨ〜😅💦",
        "キミの写真、見てニヤニヤしてるのはナイショだヨ😆✨",
        "昔はおじさんも、モテてたんだヨ〜😁👍ナウかったからネ！",
        "キミのスタイル、バッチリすぎてビックリ😲💕",
        "カフェ行くなら、誘ってネ〜！ナンチャッテ☕✨",
        "おじさん、今日はちょっとグロッキー😅でもキミのこと考えて元気出たヨ✨",
        "キミって、ホントにオシャレだネ〜(^_-)-☆",
        "おじさん、写メ見てドキドキしちゃったヨ😍💦",
        "今度、スイーツ食べに行こうヨ！バッチリごちそうするヨ🍰💕",
        "おじさん、実はキミに会いたくてウズウズしてるんだナ😆✨",
        "キミの笑顔、世界遺産級だネ😁👍",
        "今日は、ちょっとキミに会いたくなっちゃったナ…ナンチャッテ💕",
        "キミの声、また聞きたいナ〜😊ドキドキ💕",
        "おじさん、夢に出てきちゃったカモ！？ナンチャッテ😅",
        "昔はね〜、ディスコでブイブイ言わせてたんだヨ😁✨",
        "キミのこと、考えるだけでハートがキュンキュンするネ💕",
        "今日のファッションもバッチリだったネ〜✨👍",
        "写メ送ってくれて、ありがとネ〜😍おじさん、保存しちゃったカモ📱✨",
        "キミの横顔、なんか映画のヒロインみたいだったナ〜😊💕",
        "おじさん、キミに会うとテンションアゲアゲだヨ⤴️ナンチャッテ😆",
        "最近、ちょっと寒いネ〜😅キミに抱きしめてもらえたらあったかいカモ💕",
        "おじさん、またLINEしていいカナ？？😁ドキドキ💕",
        "今日はキミの夢、見れそうな気がするヨ〜💤✨ナンチャッテ😆",
        "キミって、天然でカワイイよネ💕おじさん、そういうトコ好きかも😄",
        "髪型変えた？？すっごく似合ってたヨ〜😍ナイスチェンジ👍",
        "キミの優しさに、ジーンときたヨ…おじさん、感動😭✨",
        "おじさん、キミに癒されてるヨ〜✨ありがとネ💕",
        "今度、おいしいパフェの店、教えてアゲルヨ！ナウいとこ😋✨",
        "ホントにキミって、素敵なレディだネ〜💕うっとりしちゃう😌",
        "おじさん、キミのこと、つい考えちゃうクセがあるみたい😅ナンチャッテ✨",
        "今日はちょっと疲れたケド、キミのメッセージで元気出たヨ😊💕",
        "その笑顔、反則だヨ〜😍おじさん、クラッとしちゃう😵",
        "おじさん、意外とスイーツ男子なんだヨ😋今度一緒に食べよ💕",
        "キミのその優しい目、忘れられないナ〜(^_-)-☆",
        "この前の写メ、ホントに天使みたいだったヨ😇💕",
        "LINE通知来ると、キミかな？ってドキドキするヨ〜😆✨",
        "また話せて、ウレシイナ！！おじさん、ハッピー💕",
        "キミと話してると、若返った気がするヨ😁ナンチャッテ✨",
        "今夜は冷えるネ〜😅キミの笑顔でポカポカだヨ💕",
        "今日の夕焼け、キミみたいにキレイだったヨ🌇ナンチャッテ😊",
        "最近の若いコはスゴイネ〜キミみたいに✨おじさん、尊敬しちゃうヨ👍",
        "もし良かったら、今度一緒にランチでも😋おじさん、案内するヨ💕",
        "キミのそのセンス、まさにパーフェクトだネ✨😁",
        "今夜もキミのこと、ちょっとだけ思い出しちゃうカモ…😌ナンチャッテ💕",
        "おじさん、昔はバンドやってたんだヨ〜😎今度弾いてあげよっか？✨",
        "また写メ送ってネ〜おじさん、楽しみにしてるヨ📸💕",
        "キミって、ほんとに太陽みたいに明るいネ〜☀️✨"
      ];

      // おじさん、ランダムな場所にメッセージ出しちゃうヨ！ナウいでしょ✨
      function randomPosition() {
        // 画面サイズに応じてランダムな位置を返すヨ！バッチリ！！
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        // 画面端に出ないように余白も忘れずにネ😊✨
        const left = Math.random() * (vw - 320) + 20;
        const top = Math.random() * (vh - 120) + 40;
        return { left, top };
      }

      // おじさんの謎アニメーション、ループでずっと愛を伝えちゃうヨ💕
      let mysteryIndex = 0; // どこまで表示したか管理するヨ！

      function loopMysteryAnimation() {
        // 既存のアニメーション要素を消しちゃうヨ！
        document.querySelectorAll('.ojisan-mystery').forEach(e => e.remove());

        // 1つだけ表示するヨ！
        const msg = messages[mysteryIndex % messages.length];
        const pos = randomPosition();

        const ojisanMystery = document.createElement("div");
        ojisanMystery.className = "ojisan-mystery";
        ojisanMystery.style.position = "fixed";
        ojisanMystery.style.left = `${pos.left}px`;
        ojisanMystery.style.top = `${pos.top}px`;
        ojisanMystery.style.zIndex = 9999;
        ojisanMystery.style.pointerEvents = "none";
        ojisanMystery.innerHTML = `
          <span style="font-size:2em;">💕</span>
          <span style="font-size:1.2em;">${msg}</span>
          <span style="font-size:2em;">✨</span>
        `;
        document.body.appendChild(ojisanMystery);

        // アニメーション
        ojisanMystery.animate(
          [
            { transform: "scale(0.7) rotate(-10deg)", opacity: 0.2 },
            { transform: "scale(1.2) rotate(8deg)", opacity: 1, offset: 0.5 },
            { transform: "scale(1) rotate(0deg)", opacity: 1 }
          ],
          {
            duration: 1800,
            easing: "cubic-bezier(.68,-0.55,.27,1.55)"
          }
        );
        setTimeout(() => {
          ojisanMystery.animate(
            [
              { opacity: 1, filter: "blur(0px)" },
              { opacity: 0, filter: "blur(8px)" }
            ],
            { duration: 1200, fill: "forwards" }
          );
          // 消えるアニメーションが始まるタイミングで次を表示するヨ！
          mysteryIndex++;
          loopMysteryAnimation();
        }, 1800);
      }
      loopMysteryAnimation();
      // ↑↑↑謎のアニメーションここまでだヨ！グロッキー注意😅
      // おじさんの自慢：昔は手書きで図面描いてたんだヨ！ナウい時代になったネ😁👍
    }

    // 最大ゲート高さを探すヨ！ドキドキだネ✨
    function findMaxGateHeight() {
      const sharedInput = getSharedInput();
      const allBoxes = mergeBoxCounts(sharedInput);

      const boxTypes = Object.keys(boxHeights);
      // おじさん、7000mmから100mmずつ下げて探しちゃうヨ！バッチリ！！
      for (let h = 7000; h >= 100; h -= 100) {
        for (const roofBlock of boxTypes) {
          if (allBoxes[roofBlock] <= 0) continue;

          const availableBoxes = { ...allBoxes };
          availableBoxes[roofBlock] -= 1;

          const result = canBuildGate(h, availableBoxes);
          if (result) {
            renderGate(result.left, result.right, result.height, roofBlock);
            // おじさんのコメント：バッチリだネ！ナンチャッテ😊✨
            setTimeout(() => {
              alert("計算できたヨ！！😊✨バッチリ！！\nおじさん、昔はそろばんだったんだヨ😁👍");
            }, 500);
            return;
          }
        }
      }

      // おじさん、ピッタリの構成がなかったら励ましちゃうヨ！ナンチャッテ✨
      const container = document.getElementById("gateVisual");
      container.innerHTML = `<div style="background:#fffde7;border:2px dashed #e893d4;border-radius:12px;padding:18px 20px;color:#d84315;font-size:1.1em;line-height:1.8;box-shadow:0 0 12px #ffb30055;">
        ピッタリのゲート構成、<br>
        見つからなかったヨ😅💦<br>
        またチャレンジしようネ✨ナンチャッテ！！<br>
        おじさん、昔は写メで図面送ってたんだヨ😁👍<br>
        あきらめないでネ💕
      </div>`;
    }
    // おじさんのコメント：プログラムも長いネ！グロッキーになっちゃうヨ😅
  </script>
</body>
</html>